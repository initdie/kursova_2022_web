{"ast":null,"code":"import axios from 'axios';\nimport { addFile, deleteFileAction, setFiles } from \"../reducers/fileReducer\";\nimport { addUploadFile, changeUploadFile, showUploader } from \"../reducers/uploadReducer\";\nimport { hideLoader, showLoader } from \"../reducers/appReducer\";\nimport { API_URL } from \"../config\";\nexport function getFiles(dirId, sort) {\n  return async dispatch => {\n    try {\n      dispatch(showLoader());\n      let url = `${API_URL}api/files`;\n\n      if (dirId) {\n        url = `${API_URL}api/files?parent=${dirId}`;\n      }\n\n      if (sort) {\n        url = `${API_URL}api/files?sort=${sort}`;\n      }\n\n      if (dirId && sort) {\n        url = `${API_URL}api/files?parent=${dirId}&sort=${sort}`;\n      }\n\n      const response = await axios.get(url, {\n        headers: {\n          Authorization: `Bearer ${localStorage.getItem('token')}`\n        }\n      });\n      dispatch(setFiles(response.data));\n    } catch (e) {\n      alert(e.response.data.message);\n    } finally {\n      dispatch(hideLoader());\n    }\n  };\n}\nexport function createDir(dirId, name) {\n  return async dispatch => {\n    try {\n      const response = await axios.post(`${API_URL}api/files`, {\n        name,\n        parent: dirId,\n        type: 'dir'\n      }, {\n        headers: {\n          Authorization: `Bearer ${localStorage.getItem('token')}`\n        }\n      });\n      dispatch(addFile(response.data));\n    } catch (e) {\n      alert(e.response.data.message);\n    }\n  };\n}\nexport function uploadFile(file, dirId) {\n  return async dispatch => {\n    try {\n      const formData = new FormData();\n      formData.append('file', file);\n\n      if (dirId) {\n        formData.append('parent', dirId);\n      }\n\n      const uploadFile = {\n        name: file.name,\n        progress: 0,\n        id: Date.now()\n      };\n      dispatch(showUploader());\n      dispatch(addUploadFile(uploadFile));\n      const response = await axios.post(`${API_URL}api/files/upload`, formData, {\n        headers: {\n          Authorization: `Bearer ${localStorage.getItem('token')}`\n        },\n        onUploadProgress: progressEvent => {\n          const totalLength = progressEvent.lengthComputable ? progressEvent.total : progressEvent.target.getResponseHeader('content-length') || progressEvent.target.getResponseHeader('x-decompressed-content-length');\n\n          if (totalLength) {\n            uploadFile.progress = Math.round(progressEvent.loaded * 100 / totalLength);\n            dispatch(changeUploadFile(uploadFile));\n          }\n        }\n      });\n      dispatch(addFile(response.data));\n    } catch (e) {\n      var _e$response, _e$response$data;\n\n      alert(e === null || e === void 0 ? void 0 : (_e$response = e.response) === null || _e$response === void 0 ? void 0 : (_e$response$data = _e$response.data) === null || _e$response$data === void 0 ? void 0 : _e$response$data.message);\n    }\n  };\n}\nexport async function downloadFile(file) {\n  const response = await fetch(`${API_URL}api/files/download?id=${file._id}`, {\n    headers: {\n      Authorization: `Bearer ${localStorage.getItem('token')}`\n    }\n  });\n\n  if (response.status === 200) {\n    const blob = await response.blob();\n    const downloadUrl = window.URL.createObjectURL(blob);\n    const link = document.createElement('a');\n    link.href = downloadUrl;\n    link.download = file.name;\n    document.body.appendChild(link);\n    link.click();\n    link.remove();\n  }\n}\nexport function deleteFile(file) {\n  return async dispatch => {\n    try {\n      const response = await axios.delete(`${API_URL}api/files?id=${file._id}`, {\n        headers: {\n          Authorization: `Bearer ${localStorage.getItem('token')}`\n        }\n      });\n      dispatch(deleteFileAction(file._id));\n      alert(response.data.message);\n    } catch (e) {\n      var _e$response2, _e$response2$data;\n\n      alert(e === null || e === void 0 ? void 0 : (_e$response2 = e.response) === null || _e$response2 === void 0 ? void 0 : (_e$response2$data = _e$response2.data) === null || _e$response2$data === void 0 ? void 0 : _e$response2$data.message);\n    }\n  };\n}\nexport function searchFiles(search) {\n  return async dispatch => {\n    try {\n      const response = await axios.get(`${API_URL}api/files/search?search=${search}`, {\n        headers: {\n          Authorization: `Bearer ${localStorage.getItem('token')}`\n        }\n      });\n      dispatch(setFiles(response.data));\n    } catch (e) {\n      var _e$response3, _e$response3$data;\n\n      alert(e === null || e === void 0 ? void 0 : (_e$response3 = e.response) === null || _e$response3 === void 0 ? void 0 : (_e$response3$data = _e$response3.data) === null || _e$response3$data === void 0 ? void 0 : _e$response3$data.message);\n    } finally {\n      dispatch(hideLoader());\n    }\n  };\n}","map":{"version":3,"sources":["C:/Users/38095/Desktop/MERN-cloud-disk-4523999939031cf4fe6202680e7a26163cdd92e8/client/src/actions/file.js"],"names":["axios","addFile","deleteFileAction","setFiles","addUploadFile","changeUploadFile","showUploader","hideLoader","showLoader","API_URL","getFiles","dirId","sort","dispatch","url","response","get","headers","Authorization","localStorage","getItem","data","e","alert","message","createDir","name","post","parent","type","uploadFile","file","formData","FormData","append","progress","id","Date","now","onUploadProgress","progressEvent","totalLength","lengthComputable","total","target","getResponseHeader","Math","round","loaded","downloadFile","fetch","_id","status","blob","downloadUrl","window","URL","createObjectURL","link","document","createElement","href","download","body","appendChild","click","remove","deleteFile","delete","searchFiles","search"],"mappings":"AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,SAAQC,OAAR,EAAiBC,gBAAjB,EAAmCC,QAAnC,QAAkD,yBAAlD;AACA,SAAQC,aAAR,EAAuBC,gBAAvB,EAAyCC,YAAzC,QAA4D,2BAA5D;AACA,SAAQC,UAAR,EAAoBC,UAApB,QAAqC,wBAArC;AACA,SAAQC,OAAR,QAAsB,WAAtB;AAEA,OAAO,SAASC,QAAT,CAAkBC,KAAlB,EAAyBC,IAAzB,EAA+B;AAClC,SAAO,MAAMC,QAAN,IAAkB;AACrB,QAAI;AACAA,MAAAA,QAAQ,CAACL,UAAU,EAAX,CAAR;AACA,UAAIM,GAAG,GAAI,GAAEL,OAAQ,WAArB;;AACA,UAAIE,KAAJ,EAAW;AACPG,QAAAA,GAAG,GAAI,GAAEL,OAAQ,oBAAmBE,KAAM,EAA1C;AACH;;AACD,UAAIC,IAAJ,EAAU;AACNE,QAAAA,GAAG,GAAI,GAAEL,OAAQ,kBAAiBG,IAAK,EAAvC;AACH;;AACD,UAAID,KAAK,IAAIC,IAAb,EAAmB;AACfE,QAAAA,GAAG,GAAI,GAAEL,OAAQ,oBAAmBE,KAAM,SAAQC,IAAK,EAAvD;AACH;;AACD,YAAMG,QAAQ,GAAG,MAAMf,KAAK,CAACgB,GAAN,CAAUF,GAAV,EAAe;AAClCG,QAAAA,OAAO,EAAE;AAACC,UAAAA,aAAa,EAAG,UAASC,YAAY,CAACC,OAAb,CAAqB,OAArB,CAA8B;AAAxD;AADyB,OAAf,CAAvB;AAGAP,MAAAA,QAAQ,CAACV,QAAQ,CAACY,QAAQ,CAACM,IAAV,CAAT,CAAR;AACH,KAhBD,CAgBE,OAAOC,CAAP,EAAU;AACRC,MAAAA,KAAK,CAACD,CAAC,CAACP,QAAF,CAAWM,IAAX,CAAgBG,OAAjB,CAAL;AACH,KAlBD,SAkBU;AACNX,MAAAA,QAAQ,CAACN,UAAU,EAAX,CAAR;AACH;AACJ,GAtBD;AAuBH;AAED,OAAO,SAASkB,SAAT,CAAmBd,KAAnB,EAA0Be,IAA1B,EAAgC;AACnC,SAAO,MAAMb,QAAN,IAAkB;AACrB,QAAI;AACA,YAAME,QAAQ,GAAG,MAAMf,KAAK,CAAC2B,IAAN,CAAY,GAAElB,OAAQ,WAAtB,EAAiC;AACpDiB,QAAAA,IADoD;AAEpDE,QAAAA,MAAM,EAAEjB,KAF4C;AAGpDkB,QAAAA,IAAI,EAAE;AAH8C,OAAjC,EAIpB;AACCZ,QAAAA,OAAO,EAAE;AAACC,UAAAA,aAAa,EAAG,UAASC,YAAY,CAACC,OAAb,CAAqB,OAArB,CAA8B;AAAxD;AADV,OAJoB,CAAvB;AAOAP,MAAAA,QAAQ,CAACZ,OAAO,CAACc,QAAQ,CAACM,IAAV,CAAR,CAAR;AACH,KATD,CASE,OAAOC,CAAP,EAAU;AACRC,MAAAA,KAAK,CAACD,CAAC,CAACP,QAAF,CAAWM,IAAX,CAAgBG,OAAjB,CAAL;AACH;AACJ,GAbD;AAcH;AAED,OAAO,SAASM,UAAT,CAAoBC,IAApB,EAA0BpB,KAA1B,EAAiC;AACpC,SAAO,MAAME,QAAN,IAAkB;AACrB,QAAI;AACA,YAAMmB,QAAQ,GAAG,IAAIC,QAAJ,EAAjB;AACAD,MAAAA,QAAQ,CAACE,MAAT,CAAgB,MAAhB,EAAwBH,IAAxB;;AACA,UAAIpB,KAAJ,EAAW;AACPqB,QAAAA,QAAQ,CAACE,MAAT,CAAgB,QAAhB,EAA0BvB,KAA1B;AACH;;AACD,YAAMmB,UAAU,GAAG;AAACJ,QAAAA,IAAI,EAAEK,IAAI,CAACL,IAAZ;AAAkBS,QAAAA,QAAQ,EAAE,CAA5B;AAA+BC,QAAAA,EAAE,EAAEC,IAAI,CAACC,GAAL;AAAnC,OAAnB;AACAzB,MAAAA,QAAQ,CAACP,YAAY,EAAb,CAAR;AACAO,MAAAA,QAAQ,CAACT,aAAa,CAAC0B,UAAD,CAAd,CAAR;AACA,YAAMf,QAAQ,GAAG,MAAMf,KAAK,CAAC2B,IAAN,CAAY,GAAElB,OAAQ,kBAAtB,EAAyCuB,QAAzC,EAAmD;AACtEf,QAAAA,OAAO,EAAE;AAACC,UAAAA,aAAa,EAAG,UAASC,YAAY,CAACC,OAAb,CAAqB,OAArB,CAA8B;AAAxD,SAD6D;AAEtEmB,QAAAA,gBAAgB,EAAEC,aAAa,IAAI;AAC/B,gBAAMC,WAAW,GAAGD,aAAa,CAACE,gBAAd,GAAiCF,aAAa,CAACG,KAA/C,GAAuDH,aAAa,CAACI,MAAd,CAAqBC,iBAArB,CAAuC,gBAAvC,KAA4DL,aAAa,CAACI,MAAd,CAAqBC,iBAArB,CAAuC,+BAAvC,CAAvI;;AACA,cAAIJ,WAAJ,EAAiB;AACbX,YAAAA,UAAU,CAACK,QAAX,GAAsBW,IAAI,CAACC,KAAL,CAAYP,aAAa,CAACQ,MAAd,GAAuB,GAAxB,GAA+BP,WAA1C,CAAtB;AACA5B,YAAAA,QAAQ,CAACR,gBAAgB,CAACyB,UAAD,CAAjB,CAAR;AACH;AACJ;AARqE,OAAnD,CAAvB;AAUAjB,MAAAA,QAAQ,CAACZ,OAAO,CAACc,QAAQ,CAACM,IAAV,CAAR,CAAR;AACH,KApBD,CAoBE,OAAOC,CAAP,EAAU;AAAA;;AACRC,MAAAA,KAAK,CAACD,CAAD,aAACA,CAAD,sCAACA,CAAC,CAAEP,QAAJ,oEAAC,YAAaM,IAAd,qDAAC,iBAAmBG,OAApB,CAAL;AACH;AACJ,GAxBD;AAyBH;AAGD,OAAO,eAAeyB,YAAf,CAA4BlB,IAA5B,EAAkC;AACrC,QAAMhB,QAAQ,GAAG,MAAMmC,KAAK,CAAE,GAAEzC,OAAQ,yBAAwBsB,IAAI,CAACoB,GAAI,EAA7C,EAA+C;AACvElC,IAAAA,OAAO,EAAE;AACLC,MAAAA,aAAa,EAAG,UAASC,YAAY,CAACC,OAAb,CAAqB,OAArB,CAA8B;AADlD;AAD8D,GAA/C,CAA5B;;AAKA,MAAIL,QAAQ,CAACqC,MAAT,KAAoB,GAAxB,EAA6B;AACzB,UAAMC,IAAI,GAAG,MAAMtC,QAAQ,CAACsC,IAAT,EAAnB;AACA,UAAMC,WAAW,GAAGC,MAAM,CAACC,GAAP,CAAWC,eAAX,CAA2BJ,IAA3B,CAApB;AACA,UAAMK,IAAI,GAAGC,QAAQ,CAACC,aAAT,CAAuB,GAAvB,CAAb;AACAF,IAAAA,IAAI,CAACG,IAAL,GAAYP,WAAZ;AACAI,IAAAA,IAAI,CAACI,QAAL,GAAgB/B,IAAI,CAACL,IAArB;AACAiC,IAAAA,QAAQ,CAACI,IAAT,CAAcC,WAAd,CAA0BN,IAA1B;AACAA,IAAAA,IAAI,CAACO,KAAL;AACAP,IAAAA,IAAI,CAACQ,MAAL;AACH;AACJ;AAED,OAAO,SAASC,UAAT,CAAoBpC,IAApB,EAA0B;AAC7B,SAAO,MAAMlB,QAAN,IAAkB;AACrB,QAAI;AACA,YAAME,QAAQ,GAAG,MAAMf,KAAK,CAACoE,MAAN,CAAc,GAAE3D,OAAQ,gBAAesB,IAAI,CAACoB,GAAI,EAAhD,EAAkD;AACrElC,QAAAA,OAAO,EAAC;AACJC,UAAAA,aAAa,EAAG,UAASC,YAAY,CAACC,OAAb,CAAqB,OAArB,CAA8B;AADnD;AAD6D,OAAlD,CAAvB;AAKAP,MAAAA,QAAQ,CAACX,gBAAgB,CAAC6B,IAAI,CAACoB,GAAN,CAAjB,CAAR;AACA5B,MAAAA,KAAK,CAACR,QAAQ,CAACM,IAAT,CAAcG,OAAf,CAAL;AACH,KARD,CAQE,OAAOF,CAAP,EAAU;AAAA;;AACRC,MAAAA,KAAK,CAACD,CAAD,aAACA,CAAD,uCAACA,CAAC,CAAEP,QAAJ,sEAAC,aAAaM,IAAd,sDAAC,kBAAmBG,OAApB,CAAL;AACH;AACJ,GAZD;AAaH;AAED,OAAO,SAAS6C,WAAT,CAAqBC,MAArB,EAA6B;AAChC,SAAO,MAAMzD,QAAN,IAAkB;AACrB,QAAI;AACA,YAAME,QAAQ,GAAG,MAAMf,KAAK,CAACgB,GAAN,CAAW,GAAEP,OAAQ,2BAA0B6D,MAAO,EAAtD,EAAwD;AAC3ErD,QAAAA,OAAO,EAAC;AACJC,UAAAA,aAAa,EAAG,UAASC,YAAY,CAACC,OAAb,CAAqB,OAArB,CAA8B;AADnD;AADmE,OAAxD,CAAvB;AAKAP,MAAAA,QAAQ,CAACV,QAAQ,CAACY,QAAQ,CAACM,IAAV,CAAT,CAAR;AACH,KAPD,CAOE,OAAOC,CAAP,EAAU;AAAA;;AACRC,MAAAA,KAAK,CAACD,CAAD,aAACA,CAAD,uCAACA,CAAC,CAAEP,QAAJ,sEAAC,aAAaM,IAAd,sDAAC,kBAAmBG,OAApB,CAAL;AACH,KATD,SASU;AACNX,MAAAA,QAAQ,CAACN,UAAU,EAAX,CAAR;AACH;AACJ,GAbD;AAcH","sourcesContent":["import axios from 'axios'\nimport {addFile, deleteFileAction, setFiles} from \"../reducers/fileReducer\";\nimport {addUploadFile, changeUploadFile, showUploader} from \"../reducers/uploadReducer\";\nimport {hideLoader, showLoader} from \"../reducers/appReducer\";\nimport {API_URL} from \"../config\";\n\nexport function getFiles(dirId, sort) {\n    return async dispatch => {\n        try {\n            dispatch(showLoader())\n            let url = `${API_URL}api/files`\n            if (dirId) {\n                url = `${API_URL}api/files?parent=${dirId}`\n            }\n            if (sort) {\n                url = `${API_URL}api/files?sort=${sort}`\n            }\n            if (dirId && sort) {\n                url = `${API_URL}api/files?parent=${dirId}&sort=${sort}`\n            }\n            const response = await axios.get(url, {\n                headers: {Authorization: `Bearer ${localStorage.getItem('token')}`}\n            });\n            dispatch(setFiles(response.data))\n        } catch (e) {\n            alert(e.response.data.message)\n        } finally {\n            dispatch(hideLoader())\n        }\n    }\n}\n\nexport function createDir(dirId, name) {\n    return async dispatch => {\n        try {\n            const response = await axios.post(`${API_URL}api/files`,{\n                name,\n                parent: dirId,\n                type: 'dir'\n            }, {\n                headers: {Authorization: `Bearer ${localStorage.getItem('token')}`}\n            })\n            dispatch(addFile(response.data))\n        } catch (e) {\n            alert(e.response.data.message)\n        }\n    }\n}\n\nexport function uploadFile(file, dirId) {\n    return async dispatch => {\n        try {\n            const formData = new FormData()\n            formData.append('file', file)\n            if (dirId) {\n                formData.append('parent', dirId)\n            }\n            const uploadFile = {name: file.name, progress: 0, id: Date.now()}\n            dispatch(showUploader())\n            dispatch(addUploadFile(uploadFile))\n            const response = await axios.post(`${API_URL}api/files/upload`, formData, {\n                headers: {Authorization: `Bearer ${localStorage.getItem('token')}`},\n                onUploadProgress: progressEvent => {\n                    const totalLength = progressEvent.lengthComputable ? progressEvent.total : progressEvent.target.getResponseHeader('content-length') || progressEvent.target.getResponseHeader('x-decompressed-content-length');\n                    if (totalLength) {\n                        uploadFile.progress = Math.round((progressEvent.loaded * 100) / totalLength)\n                        dispatch(changeUploadFile(uploadFile))\n                    }\n                }\n            });\n            dispatch(addFile(response.data))\n        } catch (e) {\n            alert(e?.response?.data?.message)\n        }\n    }\n}\n\n\nexport async function downloadFile(file) {\n    const response = await fetch(`${API_URL}api/files/download?id=${file._id}`,{\n        headers: {\n            Authorization: `Bearer ${localStorage.getItem('token')}`\n        }\n    })\n    if (response.status === 200) {\n        const blob = await response.blob()\n        const downloadUrl = window.URL.createObjectURL(blob)\n        const link = document.createElement('a')\n        link.href = downloadUrl\n        link.download = file.name\n        document.body.appendChild(link)\n        link.click()\n        link.remove()\n    }\n}\n\nexport function deleteFile(file) {\n    return async dispatch => {\n        try {\n            const response = await axios.delete(`${API_URL}api/files?id=${file._id}`,{\n                headers:{\n                    Authorization: `Bearer ${localStorage.getItem('token')}`\n                }\n            })\n            dispatch(deleteFileAction(file._id))\n            alert(response.data.message)\n        } catch (e) {\n            alert(e?.response?.data?.message)\n        }\n    }\n}\n\nexport function searchFiles(search) {\n    return async dispatch => {\n        try {\n            const response = await axios.get(`${API_URL}api/files/search?search=${search}`,{\n                headers:{\n                    Authorization: `Bearer ${localStorage.getItem('token')}`\n                }\n            })\n            dispatch(setFiles(response.data))\n        } catch (e) {\n            alert(e?.response?.data?.message)\n        } finally {\n            dispatch(hideLoader())\n        }\n    }\n}\n"]},"metadata":{},"sourceType":"module"}